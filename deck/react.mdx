import { future } from 'mdx-deck/themes'
import { darcula as themeSyntax } from 'react-syntax-highlighter/styles/prism';
import nightOwl from "prism-react-renderer/themes/nightOwl"

export const theme = {
  ...future,
  codeSurfer: {
  ...nightOwl,
    showNumbers: false
  }
}

import { Head, Image, Notes, Appear } from 'mdx-deck'
import { Invert, Split, FullScreenCode, Horizontal} from 'mdx-deck/layouts'
import { CodeSurfer } from "mdx-deck-code-surfer"
//import SyntaxHighlighter from "react-syntax-highlighter/prism-light";
import SyntaxHighlighter from 'react-syntax-highlighter/prism';

import Code from './helpers/Code'
import C from './helpers/C'
import asCode,{__ as Z} from './helpers/asCode'
import InRead from './snippets/Inread'

import HelloWorld from './snippets/HelloWorld'
import NotificationPanelWithDismiss from './snippets/NotificationPanelWithDismiss'
import NotificationPanelWithFetch from './snippets/NotificationPanelWithFetch'
import FormDemo from './snippets/FormDemo'




<Head>
  <title>React training for Users</title>
</Head>

  
# <React 🇧🇷/> 
###  tudo vai bem sentes-te feliz!



###### Hervé Bourzeix - January '19 💻 



---

## 👨👷🏋Who are you ❓ 

---

## 👨 Who am I ❓ 

---
 
## 🛫 Our journey 🛬


    Introduction to React 

    Some reminders about JS

    React in depth

    Redux


---


    Once upon a time ...

---


<CodeSurfer
  title="🏎️ Back to the future 🏎️"
  code={require("!raw-loader!./snippets/code.php")}
  lang="php"
  steps={[
    { notes: "🍿️" },
    { lines: [2], notes: "establish the cnx️" },
    { lines: [3,4], notes: "run a db query️" },
    { lines: [7,8,9], notes: "output the result" }
  ]}
/>

---

<CodeSurfer
  title="What is React?️"
  code={
  `ReactDOM.render(
     <h1>Hello, world!</h1>,
     document.getElementById('root')
   );`
  }
  lang="jsx"
  steps={[
    { notes: "🦄️" },
    { lines: [2], notes: "this is not HTML" }
  ]}
/> 

---
## What is React

<Appear>
    <div>This is a library to build UI</div>
    <div>focus on how the UI should look 
    Rather than how to change it</div>
</Appear>

---

Unidirectional flux

<Appear>
    <div>️➡️ ️Event️</div>
    <div>➡️  State modification</div>
    <div>➡️  Render️</div>
</Appear>

  
---

Virtual DOM

<Appear>
    <div>
        <HelloWorld/>
    </div>        
</Appear>


---

Virtual DOM 

React fiber: 
https://claudiopro.github.io/react-fiber-vs-stack-demo/
    

---

Declarative & Composable

<Code>{`
    <NotificationPanel name="main">
        <Notification level="Important">Mind your step!</Notification>
    </NotificationPanel>
    `}</Code>

---

Event Delegate 


---

Some reminders about ~~JavaScript~~ 

EcmaScript 🚀


---
<CodeSurfer 
    title="ES2015: Object destructuration" 
    lang="jsx"
    code={require("!raw-loader!./snippets/objDestructuration.js")}
    
/>

---
<CodeSurfer 
    title="ES2015: Array destructuration" 
      steps={[
        { notes: "Apply to RegEx" },
        { lines: [4], notes: "1st is the whole then groups" },
        { lines: [9], notes: "no unused variables👍️" },
      ]}
    
    code={`
    const path='/myredirect?access_token=1234'
    
    const [match, token] = /[#?&]access_token=([\w]{32})/.exec(path)
    
    console.log(token) // 1234
    
    // can omit, unwanted values
    const [, token] = /[#?&]access_token=([\w]{32})/.exec(path)
    `}
        
/>
---

<CodeSurfer title="Fat Arrow" steps={[
    { notes: "Expression, not a statement" },
    { notes: "Automatically bind to this" },
    { lines: [2] },
    { lines: [4] },
    { lines: [6] },
    ]}
code={`
    const foo1 = () => ({})
    
    const foo2 = () => { return 1337 }
    
    const foo3 = ({} = {p}) => ({p})
`}
/>


---

<CodeSurfer title="Properties" steps={[
    { lines: [2,3] },
    { lines: [4,5,6,7] },
    { lines: [8,9] },
    ]}
code={`
    const firstName = "Pierre"
    const lastName = "Chappaz"
    const user = {
        firstName: firstName,
        lastName: lastName
    }
    // shortcut as 
    const user = {firstName,lastName}
    
`}
/>


---

<CodeSurfer title="Properties: alias"
    steps={[{  }]}
    code={`
            const user = {firstName:"Pierre",lastName:"Chappaz"}
        
            const {
                firstName: prenom,
                lastName: nom
            } = user
            
            console.info(prenom,nom)
`}
/>

---

<CodeSurfer title="Properties: dynamic" 
    steps={[{  }]}
    code={`
    const propertyName = 'lastName'
    const propertyValue = 'Chappaz'
    
    const user = {
        [propertyName] : propertyValue
    }    
`}
/>

---

## ES2015 import / export 

<Code>
{`
    // constants.js
    export const MY_CONSTANT = 1 
    // main.js
    import {MY_CONSTANT} from './constants'
`}
</Code>


---
## ES2015 import / export 

<Code>
{`
    // identity.js
    export default (x) => x
    // main.js
    import identity from './identity'
`}
</Code>

---

## ES2015 import / export 

<Code>
{`
    // identity.js
    const identity  = (x) => x
    export {identity}
    // main.js
    import {identity} from './identity'
    // identity(1)
    import {identity as id} from './identity'
    // id(1)
`}
</Code>

---

### ES2015 Object 

Object.assign(...)

<Code>{`
    const o1 = {firstName: "Tim"}
    const o2 = {lastName:"Barners-Lee", city: "london"}
    const user = Object.assign({},o1,o2)
`}</Code>


---

## ES2015 and beyond with Babel 
   
What is Babel? 

from 5to6 to Babel 7!

https://astexplorer.net

https://babeljs.io/repl

---


## ES2015 spread operator 

<Code>{`
    const o1 = {firstName: "Tim"}
    const o2 = {lastName:"Barners-Lee", city: "london" }
    const user = {...o1,...o2}
`}</Code>

---

## ES2015 spread operator 

<Code>{`
    // Spread operator with array
    const a1 = [1,3]
    const a2 = [3,7]
    
    // easy concat
    const user = [...a1,...a2]
    
`}</Code>

---

## ES2015: spread operator
<Code>{`
   // args is an array 
   const foo = (...args) => console.info(args)
   
   // args is are now spread    
   const foo = (...args) => console.info(...args)
      
`}</Code>


---

## ES2015: spread operator
<Code>{`
    // no more "arguments" with fat arrows
   const takeFirstArg = (first,...others) => first
   const takeFirst = ([first,...others]) => first 
   const  
   omitLastName = ({lastName,...anyOtherProps}) => ({...anyOtherProps}) 
`}</Code>
      
---

### More to learn

http://javascript.info/

[You don't (always) need Lodash](https://github.com/you-dont-need/You-Dont-Need-Lodash-Underscore)

---


## JSX

<Code>{'<MyComponent name="users" data={[1,2,3]} activated ><h1>💪</h1></MyComponent>'}</Code>
<Appear>
    <li>attributes can be strings</li>
    <li>attributes can be any valid javascript type when between braces</li>
    <li>orphane attributes are be default the boolean value true</li>
</Appear>


---



## JSX

<Code>{'<MyComponent style={{width:"100px"}}><h1>💪</h1></MyComponent>'}</Code>
<Appear>
    <li>style is an object</li>
    <li>style property are the js version</li>
    <li>min-width => minWidth</li>
</Appear>



---
## JSX

HTML class attribute is "className"

<Code>{'<MyComponent className="my-css-class"><h1>💪</h1></MyComponent>'}</Code>

<Appear>
    <div>class is a reserved javascript word keyword</div>
    <div>as JSX is tranformed into javascript ...</div>
</Appear>

---
## JSX

<Appear>
<div><Code>{'<MyComponent name="users" ><h1>💪</h1></MyComponent>'}</Code></div>
<div>is transpiled into:<Code>{`
React.createElement(
  MyComponent,
  { name: "users" },
  React.createElement("h1", null, "💪")
)
`}
</Code></div>
 
</Appear>

---

<CodeSurfer
  title="JSX️"
  code={`  
React.createElement(
  MyComponent,
  { name: "users" },
  React.createElement(MyChildren, null)
);
  `}
  lang="jsx"
  steps={[
    { lines: [5], notes: "Creates the children️" },
    { lines: [2,3,5,6], notes: "Creates the parent component️" },
    { notes: "Children is created before the parent" },
    { notes: '"React" must be in the scope' }
  ]}
/> 

---

## JSX 

JSX Prevents Injection Attacks

---

## JSX 

Can output SVG , XML ... 


---
### Tricks 

 <Code>{`
   const View = ({isVisible,children}) => {isVisible && children}
    `}
    </Code> 

---
### Tricks 

 
 <Code>{`
    ({message}) => console.info(message) || <span>{message}</span>
    `}
    </Code> 
 

---

## Tooling

Webpack 

create-react-app

https://codesandbox.io/
  
---

## Dive in React 🏊

---

<C title="Stateless component">
   {`
   // it's a render fonction
    const Notification = ({message}) => <h1>{message}</h1>
   `}
</C>

---

<CodeSurfer
  title="NotificationPanel"
  code={`
    // no render    
    const Component = (props) => (null || undefined || false)
       
    // a list using an array 
    const Component = (props) => [<option/>,<option/>,<option/>]
    
    // a list using a Fragment  (<React.Fragment> <=> <> )
    const Component = (props) => <><option/><option/><option/></>
          `}
  lang="jsx"
  steps={[
    { notes: 'Stateful component' },
    { lines: [2,3] },
    { lines: [5,6] },
    { lines: [8,9] },
  ]}
/> 



---

## Prop Types 

<Code>
{`
    import PropTypes from 'prop-types';
    
    const  Notification = ({message}) => <h1>{message}</h1>
    Notification.propTypes = {
      message: PropTypes.string.isRequired
    };
`}
</Code>

[Prop Types reference](https://reactjs.org/docs/typechecking-with-proptypes.html#proptypes)


---

## Default props 

<Code>
{`
    import PropTypes from 'prop-types';
    
    const  Notification = ({message}) => <h1>{message}</h1>
   
    Notification.defaultProps = {
      message: "Unknow"
    };
`}
</Code>


---
## Stateful component

<Appear>
    <div>
        Abilty to have its own state       
    </div>
    <div>
        Abilty to have its own methods
    </div>
    <div>
        Abilty to have its own lifecycle
    </div>
</Appear>


---

<CodeSurfer
  title="NotificationPanel"
  code={require(`!raw-loader!./snippets/NotificationPanel`)}
  lang="jsx"
  steps={[
    { notes: 'Stateful component' },
    { lines: [6,7,8], notes: "Initialize the state" },
   
    { lines: [12], notes: "get the notifications from the state" },
    { lines: [15,16,17], notes: "output the notifications" },
  ]}
/> 

---

<CodeSurfer
  title="NotificationPanelWithDismiss"
  code={require(`!raw-loader!./snippets/NotificationPanelWithDismiss`)}
  lang="jsx"
  steps={[
    { notes: 'Mutate the state!' },
    { lines: [25], notes: "add a button and capture the click" },
    { lines: [12,16], notes: "add a handler, it uses a babel plugin " },
    { lines: [13,14,15], notes: "call setState" },
    { lines: [18], notes: "render is called" }, 
  ]}
/> 

---

## Let's try

<NotificationPanelWithDismiss/>

---
## Stateful component

Lifecycle (1/2)

<Code>constructor</Code>
<Code>render</Code>
<Code>componentDidMount</Code>


---
<CodeSurfer
  title="componentDidMount"
  code={require(`!raw-loader!./snippets/NotificationPanelWithFetch`)}
  lang="jsx"
  steps={[
    { notes: 'fetch!' },
    { lines: [3], notes: "import our service" },
    { lines: [13,14,15,16,17], notes: "call our service" },
    { lines: [15], notes: "update the state" },
    { lines: [19], notes: "render is called" }, 
  ]}
/> 


---
## Let's try

<Code>{require(`!raw-loader!./snippets/service/fetchNotifications`)}</Code>

<NotificationPanelWithFetch/>


---
## Stateful component

Lifecycle (2/2)

<Code>getSnapshotBeforeUpdate</Code>
<Code>componentDidUpdate</Code>
<Code>componentWillUnmount</Code>

[more lifecycle methods](https://reactjs.org/docs/react-component.html#the-component-lifecycle)

---

<CodeSurfer
  title="Form"
  code={require(`!raw-loader!./snippets/Form`)}
  lang="jsx"
  steps={[
    { notes: 'form' },
  ]}
/> 


---

<FormDemo/>


---
Uncontrolled / Controlled

https://codesandbox.io/s/62w0k9364w

---

        Time for a break 🏝️

---

Reference 

Create Ref 

Forward Ref

---

## Render function 


A property user function called from the render function with it's own API

An API that abstract the data structure.

An API with methods to ease rendering

---

<Code>
    {`
         const NotificationPanel = ({notifications = [],renderNotification}) =>  
         (
             <div>
                 <section>
                     # of notifications: {notifications.length}                
                 </section>
                 <section>
                    {
                        notifications.map((notification,index) => renderNotification(notification))
                    }
                 </section>
                 <section>
                    /* tool bar */                                    
                 </section>            
             </div>   
         )     
    `}
</Code>


---

## HoC: higher-order component


(Component) => (EnhancedComponent) 

Use HoCs For Cross-Cutting Concerns

---

<CodeSurfer
  title="High order function"
  code={require(`!raw-loader!./snippets/HoC`)}
  lang="jsx"
  steps={[
    { notes: 'add a "loading" prop' },
    {lines : [1]},
    {lines : [4]},
    {lines : [7,8]},
  ]}
/> 


---

## HoC: higher-order component

⚠️ Many pitfall: static, refs , displayName

[recompose ❤](https://github.com/acdlite/recompose)

---

<CodeSurfer
  title="Context API (React >=16)"
  code={require(`!raw-loader!./snippets/Context`)}
  lang="jsx"
  steps={[
    { notes: 'Context API' },
    { lines: [4], notes: "create the context: Publisher / Subscriber" },
    { lines: [23,29], notes: "setup the provider" },
    { lines: [26] },
    { lines: [17,19]},
    { lines: [18]}, 
  ]}
/> 

---

Portal

https://reactjs.org/docs/portals.html

---

Server Rendering

   
    ReactDOMServer.renderToString(element)
    ReactDOMServer.renderToStaticMarkup(element)
    
    ReactDOM.hydrate()

https://codesandbox.io/s/4w7l73xj59


---

Error Handling


https://codepen.io/gaearon/pen/wqvxGa?editors=0010


---

Wrapping existing code (React-highcharts)

---

 Optimize
 
    shouldComponentUpdate 
    
    PureComponent
    
    devTool
    profiler
    
 
---


Happy React 


---

Redux 

    [Introduction to Redux](https://docs.google.com/presentation/d/1CAPLJE_eC3HDUJivNfb0cb1rBFXEAL4AjAhww947qtE/edit#slide=id.p)
